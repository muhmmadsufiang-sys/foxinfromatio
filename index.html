<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="unload=*">
    <title>Remote Desktop Pro - Professional Remote Access Solution</title>
    <!-- External Libraries -->
    <script nonce="rdp-nonce-2024" src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script nonce="rdp-nonce-2024" src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script nonce="rdp-nonce-2024" src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script nonce="rdp-nonce-2024" src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Local Files -->
    <link rel="stylesheet" href="animated-bg.css">
    <script nonce="rdp-nonce-2024" src="animated-bg.js"></script>
    <script nonce="rdp-nonce-2024" src="turn-manager.js"></script>
    <script nonce="rdp-nonce-2024" src="signaling-client.js"></script>
    <script nonce="rdp-nonce-2024">
        // Fix 6-digit code generation
        function generateId() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        // Enhanced ICE servers - now using turn-manager
        let enhancedIceServers = [
            // Custom TURN Server (Ready to use)
            {
                urls: 'turn:coturn.teachsufian.com:3478',
                username: 'sufian',
                credential: 'sufian123'
            },
            
            // AppRTC کے public servers
            {
                urls: [
                    'stun:stun.l.google.com:19302',
                    'stun:stun1.l.google.com:19302',
                    'turn:global.turn.twilio.com:3478?transport=udp'
                ],
                username: 'test',
                credential: 'test'
            },
            
            // Metered.ca TURN (Free)
            {
                urls: [
                    'turn:openrelay.metered.ca:80',
                    'turn:openrelay.metered.ca:443',
                    'turn:openrelay.metered.ca:443?transport=tcp'
                ],
                username: 'openrelayproject',
                credential: 'openrelayproject'
            }
        ];
        
        // Initialize animated background when page loads
        window.addEventListener('load', () => {
            // Initialize live background graphics for all pages
            initializeLiveBackgrounds();
            
            // Initialize animated background if available
            if (window.AnimatedBackground) {
                window.AnimatedBackground.init();
            }
            
            // Initialize turn manager
            setTimeout(() => {
                if (window.getTurnServers) {
                    enhancedIceServers = window.getTurnServers();
                    console.log('✅ ICE servers updated from turn-manager');
                }
            }, 2000);
            
            // Initialize signaling client
            if (window.signalingClient) {
                window.signalingClient.init();
            }
        });
        
        // Raw WebSocket signaling servers - now using signaling-client
        let webSocketServers = [
            'ws://localhost:8080',              // Local development
            'wss://yourserver.com/signaling',   // Your production server
            'wss://fallback1.com/signaling',    // Backup 1
            'wss://fallback2.com/signaling'     // Backup 2
        ];
        
        // Update WebSocket servers if signaling-client is available
        if (window.signalingClient) {
            webSocketServers = window.signalingClient.getServers();
        }
        
        // Fallback PeerJS signaling servers
        const signalingServers = [
            'broker-connect.peerjs.com',
            '0.peerjs.com',
            'peerjs-server.herokuapp.com'
        ];
        
        // Raw WebSocket signaling connection
        async function startSignalingConnection() {
            for (const server of webSocketServers) {
                try {
                    const ws = new WebSocket(server);
                    await new Promise((resolve, reject) => {
                        ws.onopen = resolve;
                        ws.onerror = reject;
                        setTimeout(() => reject(new Error('Timeout')), 5000);
                    });
                    return ws;
                } catch (error) {
                    console.log(`Signaling server ${server} failed`);
                }
            }
            throw new Error('Could not connect to any signaling server');
        }
        
        // WebRTC connection with raw signaling
        class WebRTCConnection {
            constructor(isHost = false) {
                this.isHost = isHost;
                this.pc = null;
                this.ws = null;
                this.roomId = null;
                this.onStream = null;
                this.onData = null;
            }
            
            async connect(roomId) {
                this.roomId = roomId;
                
                // Try WebSocket signaling first
                try {
                    this.ws = await startSignalingConnection();
                    return await this.setupWebRTCWithWebSocket();
                } catch (error) {
                    console.log('WebSocket signaling failed, falling back to PeerJS');
                    return await this.setupWithPeerJS();
                }
            }
            
            async setupWebRTCWithWebSocket() {
                this.pc = new RTCPeerConnection({ iceServers: enhancedIceServers });
                
                this.pc.onicecandidate = (event) => {
                    if (event.candidate) {
                        this.ws.send(JSON.stringify({
                            type: 'ice-candidate',
                            candidate: event.candidate,
                            roomId: this.roomId
                        }));
                    }
                };
                
                this.pc.ontrack = (event) => {
                    if (this.onStream) this.onStream(event.streams[0]);
                };
                
                this.ws.onmessage = async (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'offer') {
                        await this.pc.setRemoteDescription(data.offer);
                        const answer = await this.pc.createAnswer();
                        await this.pc.setLocalDescription(answer);
                        this.ws.send(JSON.stringify({
                            type: 'answer',
                            answer: answer,
                            roomId: this.roomId
                        }));
                    } else if (data.type === 'answer') {
                        await this.pc.setRemoteDescription(data.answer);
                    } else if (data.type === 'ice-candidate') {
                        await this.pc.addIceCandidate(data.candidate);
                    }
                };
                
                if (this.isHost) {
                    this.ws.send(JSON.stringify({
                        type: 'create-room',
                        roomId: this.roomId
                    }));
                } else {
                    this.ws.send(JSON.stringify({
                        type: 'join-room',
                        roomId: this.roomId
                    }));
                }
                
                return this;
            }
            
            async setupWithPeerJS() {
                // Fallback to existing PeerJS implementation
                return await connectWithFallback(this.roomId, this.isHost);
            }
            
            async addStream(stream) {
                if (this.pc) {
                    stream.getTracks().forEach(track => {
                        this.pc.addTrack(track, stream);
                    });
                    
                    if (this.isHost) {
                        const offer = await this.pc.createOffer();
                        await this.pc.setLocalDescription(offer);
                        this.ws.send(JSON.stringify({
                            type: 'offer',
                            offer: offer,
                            roomId: this.roomId
                        }));
                    }
                }
            }
        }
        
        // Fallback connection system
        async function connectWithFallback(id, isHost = false) {
            for (const server of signalingServers) {
                try {
                    const peer = new Peer(id, {
                        config: {
                            iceServers: enhancedIceServers,
                            iceCandidatePoolSize: 50,
                            iceTransportPolicy: 'all',
                            bundlePolicy: 'max-bundle'
                        },
                        debug: 0,
                        host: server,
                        port: 443,
                        secure: true,
                        pingInterval: 2000
                    });
                    
                    return await new Promise((resolve, reject) => {
                        const timeout = setTimeout(() => {
                            peer.destroy();
                            reject(new Error(`${server} timeout`));
                        }, 10000);
                        
                        peer.on('open', () => {
                            clearTimeout(timeout);
                            resolve(peer);
                        });
                        
                        peer.on('error', (err) => {
                            clearTimeout(timeout);
                            peer.destroy();
                            reject(err);
                        });
                    });
                } catch (error) {
                    console.log(`${server} failed, trying next...`);
                }
            }
            throw new Error('All signaling servers failed');
        }
        
        // Remove inline background animation since it's now in separate file
        // Background animation is handled by animated-bg.js
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="animated-bg.css">
    <script nonce="rdp-nonce-2024" src="animated-bg.js"></script>
    <script nonce="rdp-nonce-2024" src="signaling-client.js"></script>
    <style nonce="rdp-nonce-2024">
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #f8fafc; overflow-x: hidden; }
        /* Universal Page Styles - Same theme for all pages */
        .page {
            min-height: 100vh;
            width: 100vw;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            position: relative;
            overflow-x: hidden;
        }
        
        /* Universal animated background for all pages */
        .page::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            z-index: -1;
        }
        
        /* Universal container for all pages */
        .page-container {
            min-height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: clamp(1rem, 4vw, 2rem);
            box-sizing: border-box;
        }
        
        /* Universal content wrapper */
        .content-wrapper {
            width: 100%;
            max-width: clamp(300px, 90vw, 800px);
            background: rgba(51, 65, 85, 0.9);
            backdrop-filter: blur(20px);
            padding: clamp(1.5rem, 4vw, 3rem);
            border-radius: clamp(15px, 3vw, 20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        /* Login Page Styles */
        .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem; }
        .login-container { max-width: 400px; width: 100%; background: rgba(51, 65, 85, 0.9); backdrop-filter: blur(20px); padding: 3rem; border-radius: 20px; border: 1px solid rgba(59, 130, 246, 0.3); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); }
        .login-header { text-align: center; margin-bottom: 2rem; }
        .login-title { font-size: 2rem; font-weight: 800; color: #3b82f6; margin-bottom: 0.5rem; }
        .login-subtitle { color: #cbd5e1; font-size: 0.9rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; color: #cbd5e1; font-weight: 600; margin-bottom: 0.5rem; }
        .form-input { width: 100%; padding: 12px 16px; background: rgba(51, 65, 85, 0.6); border: 2px solid #475569; border-radius: 10px; color: white; font-size: 1rem; transition: all 0.3s ease; }
        .form-input:focus { outline: none; border-color: #3b82f6; background: rgba(51, 65, 85, 0.8); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .login-btn { width: 100%; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 12px; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-bottom: 1rem; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4); }
        .google-btn { width: 100%; background: #fff; color: #333; padding: 12px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .google-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        .divider { text-align: center; margin: 1.5rem 0; color: #64748b; position: relative; }
        .divider::before { content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #475569; }
        .divider span { background: rgba(51, 65, 85, 0.9); padding: 0 1rem; }
        
        /* Background styles moved to animated-bg.css */
        
        /* Header */
        header { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); padding: 1rem 0; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(59, 130, 246, 0.3); }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo-text { font-size: 1.5rem; font-weight: 800; color: #3b82f6; display: flex; align-items: center; gap: 0.5rem; }
        .nav-links { display: flex; gap: 2rem; }
        .nav-links a { color: #cbd5e1; text-decoration: none; transition: color 0.3s; }
        .nav-links a:hover { color: #3b82f6; }
        
        /* Hero Section */
        .hero { min-height: 100vh; display: flex; align-items: center; justify-content: center; text-align: center; padding: 2rem; }
        .hero-content { max-width: 800px; }
        .hero h1 { font-size: 4rem; font-weight: 900; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1.5rem; }
        .hero p { font-size: 1.5rem; color: #cbd5e1; margin-bottom: 3rem; line-height: 1.8; }
        .cta-btn { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 1.5rem 4rem; border: none; border-radius: 50px; font-size: 1.3rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 1rem; box-shadow: 0 20px 40px rgba(59, 130, 246, 0.4); }
        .cta-btn:hover { transform: translateY(-5px); box-shadow: 0 30px 60px rgba(59, 130, 246, 0.6); }
        
        /* Features Section */
        .features-section { padding: 5rem 2rem; background: rgba(15, 23, 42, 0.5); }
        .section-title { text-align: center; font-size: 3rem; font-weight: 800; color: #3b82f6; margin-bottom: 3rem; }
        .features-grid { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .feature-card { background: rgba(51, 65, 85, 0.8); backdrop-filter: blur(10px); padding: 2.5rem; border-radius: 20px; border: 1px solid rgba(59, 130, 246, 0.3); transition: all 0.3s ease; }
        .feature-card:hover { transform: translateY(-10px); border-color: #3b82f6; box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3); }
        .feature-icon { font-size: 3rem; color: #3b82f6; margin-bottom: 1.5rem; }
        .feature-card h3 { font-size: 1.5rem; color: #f8fafc; margin-bottom: 1rem; }
        .feature-card p { color: #cbd5e1; line-height: 1.6; }
        
        /* Stats Section */
        .stats-section { padding: 5rem 2rem; }
        .stats-grid { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; text-align: center; }
        .stat-card { background: rgba(51, 65, 85, 0.6); padding: 2rem; border-radius: 15px; border: 1px solid rgba(59, 130, 246, 0.2); }
        .stat-number { font-size: 3rem; font-weight: 900; color: #3b82f6; margin-bottom: 0.5rem; }
        .stat-label { font-size: 1.2rem; color: #cbd5e1; }
        
        /* How It Works */
        .how-section { padding: 5rem 2rem; background: rgba(15, 23, 42, 0.5); }
        .steps-grid { max-width: 1000px; margin: 0 auto; display: grid; gap: 2rem; }
        .step { display: flex; gap: 2rem; align-items: center; background: rgba(51, 65, 85, 0.6); padding: 2rem; border-radius: 15px; border-left: 4px solid #3b82f6; }
        .step-number { font-size: 3rem; font-weight: 900; color: #3b82f6; min-width: 80px; }
        .step-content h3 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .step-content p { color: #cbd5e1; line-height: 1.6; }
        
        /* Footer */
        footer { background: rgba(15, 23, 42, 0.95); padding: 3rem 2rem 1rem; border-top: 1px solid rgba(59, 130, 246, 0.3); }
        .footer-content { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 3rem; margin-bottom: 2rem; }
        .footer-section h4 { color: #3b82f6; font-size: 1.3rem; margin-bottom: 1rem; }
        .footer-section p, .footer-section a { color: #cbd5e1; text-decoration: none; display: block; margin-bottom: 0.5rem; line-height: 1.6; }
        .footer-section a:hover { color: #3b82f6; }
        .social-links { display: flex; gap: 1rem; margin-top: 1rem; }
        .social-links a { font-size: 1.5rem; color: #3b82f6; transition: transform 0.3s; }
        .social-links a:hover { transform: scale(1.2); }
        .copyright { text-align: center; padding-top: 2rem; border-top: 1px solid rgba(59, 130, 246, 0.2); color: #94a3b8; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        /* App Styles with landing page theme */
        .app-container { 
            min-height: 100vh; 
            width: 100vw;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); 
            position: relative; 
        }
        .app-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .app-header { 
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(10px); 
            padding: clamp(1rem, 2vw, 1.5rem) clamp(1rem, 3vw, 2rem); 
            border-bottom: 1px solid rgba(59, 130, 246, 0.3); 
        }
        .app-header-content { 
            max-width: 1400px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-wrap: wrap;
            gap: 1rem;
        }
        .app-title { 
            font-size: clamp(1.1rem, 4vw, 1.8rem); 
            font-weight: 800; 
            color: #3b82f6; 
            display: flex; 
            align-items: center; 
            gap: clamp(0.5rem, 1vw, 0.8rem); 
        }
        
        .main-content { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(clamp(300px, 45vw, 500px), 1fr)); 
            gap: clamp(1rem, 3vw, 2rem); 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: clamp(1rem, 3vw, 2rem); 
            min-height: calc(100vh - 100px); 
        }
        
        /* Host and Client sections with theme colors */
        .host-section, .client-section { 
            background: rgba(51, 65, 85, 0.8); 
            backdrop-filter: blur(10px); 
            border-radius: clamp(15px, 3vw, 20px); 
            padding: clamp(1rem, 3vw, 2rem); 
            border: 1px solid rgba(59, 130, 246, 0.3); 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .client-section { border: 1px solid rgba(139, 92, 246, 0.3); }
        
        .section-header { text-align: center; margin-bottom: clamp(1rem, 3vw, 2rem); }
        .section-icon { 
            font-size: clamp(2rem, 6vw, 3rem); 
            color: #10b981; 
            margin-bottom: clamp(0.5rem, 2vw, 1rem); 
        }
        .client-section .section-icon { color: #8b5cf6; }
        
        .section-title { 
            font-size: clamp(1.2rem, 4vw, 1.8rem); 
            font-weight: 700; 
            color: #f8fafc; 
            margin-bottom: clamp(0.3rem, 1vw, 0.5rem); 
        }
        .section-subtitle { 
            color: #cbd5e1; 
            font-size: clamp(0.8rem, 2vw, 1rem); 
        }
        
        /* Responsive Button System - Universal for all pages */
        .btn, .login-btn, .google-btn, .cta-btn {
            width: 100%;
            min-height: clamp(40px, 8vw, 50px);
            padding: clamp(8px, 2vw, 15px) clamp(12px, 3vw, 30px);
            font-size: clamp(0.8rem, 2.5vw, 1.1rem);
            border-radius: clamp(8px, 2vw, 12px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(0.3rem, 1vw, 0.8rem);
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn:hover, .login-btn:hover, .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
        }
        
        .btn.success {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .btn.purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        
        .google-btn {
            background: #fff;
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* Universal responsive containers */
        .login-container, .privacy-container, .terms-container, .contact-container {
            width: clamp(300px, 90vw, 800px);
            padding: clamp(1.5rem, 4vw, 3rem);
            margin: clamp(0.5rem, 2vw, 2rem);
            background: rgba(51, 65, 85, 0.9);
            backdrop-filter: blur(20px);
            border-radius: clamp(15px, 3vw, 20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        /* Universal responsive text */
        .hero h1 { font-size: clamp(2rem, 8vw, 4rem); }
        .hero p { font-size: clamp(1rem, 3vw, 1.5rem); }
        .section-title { font-size: clamp(1.8rem, 6vw, 3rem); }
        .login-title { font-size: clamp(1.5rem, 5vw, 2rem); }
        .logo-text { font-size: clamp(1rem, 3vw, 1.5rem); }
        
        /* Universal responsive inputs */
        .form-input, input {
            width: 100%;
            padding: clamp(8px, 2vw, 15px) clamp(12px, 3vw, 16px);
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            border-radius: clamp(8px, 2vw, 12px);
            background: rgba(51, 65, 85, 0.6);
            border: 2px solid #475569;
            color: white;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(51, 65, 85, 0.8);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Universal responsive grids */
        .features-grid {
            grid-template-columns: repeat(auto-fit, minmax(clamp(250px, 40vw, 300px), 1fr));
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(clamp(200px, 35vw, 250px), 1fr));
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        /* Universal responsive sections */
        .features-section, .stats-section, .how-section {
            padding: clamp(2rem, 8vw, 5rem) clamp(1rem, 4vw, 2rem);
        }
        
        .feature-card, .stat-card {
            padding: clamp(1rem, 4vw, 2.5rem);
        }
        
        /* Universal responsive controls */
        .control-group { margin-bottom: clamp(1rem, 3vw, 2rem); }
        .control-label {
            display: block;
            color: #cbd5e1;
            font-weight: 600;
            margin-bottom: clamp(0.5rem, 1vw, 0.8rem);
            font-size: clamp(0.9rem, 2vw, 1rem);
        }
        
        .input-group {
            display: flex;
            gap: clamp(0.5rem, 2vw, 1rem);
            flex-wrap: wrap;
        }
        
        .input-group input {
            flex: 1;
            min-width: clamp(150px, 30vw, 200px);
        }
        
        /* Universal responsive video container */
        .video-container {
            position: relative;
            background: #000;
            border-radius: clamp(10px, 2vw, 15px);
            overflow: hidden;
            cursor: crosshair;
            min-height: clamp(200px, 40vh, 400px);
            border: 2px solid #475569;
            width: 100%;
        }
        
        .video-container.active {
            border-color: #8b5cf6;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
        }
        
        .remote-screen {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
        
        .video-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64748b;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            text-align: center;
            padding: 1rem;
        }
        
        /* Universal responsive status and ID display */
        .status {
            padding: clamp(0.8rem, 2vw, 1.2rem);
            background: rgba(51, 65, 85, 0.6);
            border-radius: clamp(8px, 2vw, 12px);
            margin-bottom: clamp(1rem, 2vw, 1.5rem);
            border-left: 4px solid #3b82f6;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }
        
        .status.success { border-left-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .status.warning { border-left-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .status.error { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        
        .id-display {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10b981;
            padding: clamp(1rem, 3vw, 1.5rem);
            border-radius: clamp(10px, 2vw, 15px);
            margin-bottom: clamp(1rem, 3vw, 2rem);
            text-align: center;
        }
        
        .id-code {
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: 900;
            color: #10b981;
            letter-spacing: clamp(0.1em, 0.3vw, 0.2em);
            margin: clamp(0.3rem, 1vw, 0.5rem) 0;
        }
        
        .id-label {
            color: #cbd5e1;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            margin-bottom: clamp(0.5rem, 2vw, 1rem);
        }
        
        /* Universal responsive live controls */
        .live-controls {
            position: absolute;
            top: clamp(5px, 2vw, 10px);
            right: clamp(5px, 2vw, 10px);
            z-index: 20;
        }
        
        .control-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: clamp(35px, 8vw, 45px);
            height: clamp(35px, 8vw, 45px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }
        
        .controls-menu {
            position: absolute;
            top: clamp(40px, 10vw, 50px);
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-radius: clamp(6px, 1.5vw, 8px);
            padding: clamp(4px, 1vw, 8px);
            min-width: clamp(120px, 30vw, 180px);
        }
        
        .controls-menu button {
            display: flex;
            align-items: center;
            gap: clamp(4px, 1vw, 8px);
            width: 100%;
            padding: clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px);
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: clamp(3px, 1vw, 4px);
            margin-bottom: clamp(2px, 0.5vw, 4px);
            font-size: clamp(0.7rem, 2vw, 0.9rem);
        }
        
        .controls-menu button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .recording { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Inline Style Fixes */
        .header-flex { display: flex; gap: clamp(0.5rem, 2vw, 1rem); align-items: center; flex-wrap: wrap; }
        .user-email { color: #cbd5e1; font-size: clamp(0.8rem, 2vw, 0.9rem); }
        .logout-btn, .back-btn { padding: clamp(6px, 1.5vw, 8px) clamp(12px, 2vw, 16px); font-size: clamp(0.8rem, 2vw, 0.9rem); }
        .demo-btn { width: 100%; margin-bottom: clamp(0.5rem, 2vw, 1rem); }
        .center-text { text-align: center; margin-top: clamp(1rem, 3vw, 1.5rem); }
        .support-btn { margin-bottom: clamp(0.3rem, 1vw, 0.5rem); }
        .hidden { display: none; }
        .desktop-icon { font-size: 3rem; margin-bottom: 1rem; }
        .contact-item { margin: 1.5rem 0; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 10px; }
        .contact-icon { font-size: 2rem; color: #3b82f6; margin-bottom: 0.5rem; }
        .particle-1 { top: 20%; left: 15%; width: 8px; height: 8px; animation-duration: 5s; }
        .particle-2 { top: 40%; left: 80%; width: 6px; height: 6px; animation-duration: 7s; }
        .particle-3 { top: 70%; left: 25%; width: 10px; height: 10px; animation-duration: 6s; }
        .particle-4 { top: 15%; left: 70%; width: 4px; height: 4px; animation-duration: 8s; }
        .particle-5 { top: 85%; left: 60%; width: 7px; height: 7px; animation-duration: 5.5s; }
        .particle-6 { top: 30%; left: 40%; width: 5px; height: 5px; animation-duration: 6.5s; }
        .geo-triangle { top: 25%; left: 85%; animation-duration: 15s; }
        .geo-square-1 { top: 60%; left: 10%; animation-duration: 18s; }
        .geo-circle { top: 80%; left: 75%; animation-duration: 22s; }
        .geo-square-2 { top: 10%; left: 45%; animation-duration: 20s; }
        .page-title { color: #3b82f6; margin-bottom: clamp(1.5rem, 4vw, 2rem); font-size: clamp(1.8rem, 5vw, 2.5rem); }
        .page-subtitle { margin-bottom: clamp(0.8rem, 2vw, 1rem); font-size: clamp(0.9rem, 2vw, 1rem); }
        .section-spacing { margin: clamp(1.5rem, 4vw, 2rem) 0 clamp(0.8rem, 2vw, 1rem); color: #10b981; font-size: clamp(1.2rem, 3vw, 1.5rem); }
        .content-spacing { line-height: 1.6; margin-bottom: clamp(0.8rem, 2vw, 1rem); font-size: clamp(0.9rem, 2vw, 1rem); }
        .contact-spacing { margin-bottom: clamp(1.5rem, 4vw, 2rem); }
        .contact-info { margin: clamp(1.5rem, 4vw, 2rem) 0; }
        
        .privacy-container, .terms-container, .contact-container {
            width: clamp(300px, 90vw, 800px);
            padding: clamp(1rem, 4vw, 3rem);
            margin: clamp(0.5rem, 2vw, 2rem);
        }
        
        /* Responsive text sizes */
        .hero h1 { font-size: clamp(2rem, 8vw, 4rem); }
        .hero p { font-size: clamp(1rem, 3vw, 1.5rem); }
        .section-title { font-size: clamp(1.8rem, 6vw, 3rem); }
        .app-title { font-size: clamp(1.1rem, 4vw, 1.8rem); }
        .logo-text { font-size: clamp(1rem, 3vw, 1.5rem); }
        .login-title { font-size: clamp(1.5rem, 5vw, 2rem); }
        
        /* Responsive inputs */
        .form-input, input {
            padding: clamp(8px, 2vw, 15px) clamp(12px, 3vw, 16px);
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            border-radius: clamp(8px, 2vw, 12px);
        }
        
        /* Responsive grids */
        .features-grid {
            grid-template-columns: repeat(auto-fit, minmax(clamp(250px, 40vw, 300px), 1fr));
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(clamp(200px, 35vw, 250px), 1fr));
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        /* Responsive padding and margins */
        .features-section, .stats-section, .how-section {
            padding: clamp(2rem, 8vw, 5rem) clamp(1rem, 4vw, 2rem);
        }
        
        .feature-card, .stat-card {
            padding: clamp(1rem, 4vw, 2.5rem);
        }
        
        /* Responsive video container */
        .video-container {
            min-height: clamp(200px, 40vh, 400px);
            border-radius: clamp(10px, 2vw, 15px);
        }
        
        /* Responsive controls */
        .control-btn {
            width: clamp(35px, 8vw, 45px);
            height: clamp(35px, 8vw, 45px);
            font-size: clamp(0.8rem, 2vw, 1rem);
        }
        
        .controls-menu {
            min-width: clamp(120px, 30vw, 180px);
            padding: clamp(4px, 1vw, 8px);
            border-radius: clamp(6px, 1.5vw, 8px);
        }
        
        .controls-menu button {
            padding: clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px);
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            border-radius: clamp(3px, 1vw, 4px);
            margin-bottom: clamp(2px, 0.5vw, 4px);
        }
        
        /* Responsive main content */
        .main-content {
            padding: clamp(1rem, 3vw, 2rem);
            gap: clamp(1rem, 3vw, 2rem);
        }
        
        .host-section, .client-section {
            padding: clamp(1rem, 3vw, 2rem);
            border-radius: clamp(15px, 3vw, 20px);
        }
        
        /* Responsive icons */
        .section-icon, .feature-icon {
            font-size: clamp(2rem, 6vw, 3rem);
        }
        
        .contact-icon {
            font-size: clamp(1.5rem, 4vw, 2rem);
        }
        
        /* Responsive ID display */
        .id-display {
            padding: clamp(1rem, 3vw, 1.5rem);
            border-radius: clamp(10px, 2vw, 15px);
        }
        
        .id-code {
            font-size: clamp(1.2rem, 4vw, 2rem);
            letter-spacing: clamp(0.1em, 0.3vw, 0.2em);
        }
        
        /* Responsive status */
        .status {
            padding: clamp(0.8rem, 2vw, 1.2rem);
            border-radius: clamp(8px, 2vw, 12px);
            font-size: clamp(0.8rem, 2vw, 1rem);
        }
        
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; max-width: 1400px; margin: 0 auto; padding: 2rem; min-height: calc(100vh - 100px); }
        
        /* Host Section */
        .host-section { background: rgba(51, 65, 85, 0.8); backdrop-filter: blur(10px); border-radius: 20px; padding: 2rem; border: 1px solid rgba(59, 130, 246, 0.3); }
        .section-header { text-align: center; margin-bottom: 2rem; }
        .section-icon { font-size: 3rem; color: #10b981; margin-bottom: 1rem; }
        .section-title { font-size: 1.8rem; font-weight: 700; color: #f8fafc; margin-bottom: 0.5rem; }
        .section-subtitle { color: #cbd5e1; font-size: 1rem; }
        
        /* Client Section */
        .client-section { background: rgba(51, 65, 85, 0.8); backdrop-filter: blur(10px); border-radius: 20px; padding: 2rem; border: 1px solid rgba(139, 92, 246, 0.3); }
        .client-section .section-icon { color: #8b5cf6; }
        
        .btn { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 15px 30px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.8rem; justify-content: center; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3); }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4); }
        .btn.secondary { background: linear-gradient(135deg, #64748b, #475569); box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3); }
        .btn.secondary:hover { box-shadow: 0 15px 35px rgba(100, 116, 139, 0.4); }
        .btn.success { background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3); }
        .btn.success:hover { box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4); }
        .btn.purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3); }
        .btn.purple:hover { box-shadow: 0 15px 35px rgba(139, 92, 246, 0.4); }
        
        .control-group { margin-bottom: 2rem; }
        .control-label { display: block; color: #cbd5e1; font-weight: 600; margin-bottom: 0.8rem; font-size: 1rem; }
        .input-group { display: flex; gap: 1rem; }
        input { flex: 1; padding: 15px; border: 2px solid #475569; background: rgba(51, 65, 85, 0.6); color: white; border-radius: 12px; font-size: 1.1rem; transition: all 0.3s ease; }
        input:focus { outline: none; border-color: #3b82f6; background: rgba(51, 65, 85, 0.8); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        
        .id-display { background: rgba(16, 185, 129, 0.1); border: 2px solid #10b981; padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem; text-align: center; }
        .id-code { font-size: 2rem; font-weight: 900; color: #10b981; letter-spacing: 0.2em; margin: 0.5rem 0; }
        .id-label { color: #cbd5e1; font-size: 0.9rem; margin-bottom: 1rem; }
        
        .status { padding: 1.2rem; background: rgba(51, 65, 85, 0.6); border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid #3b82f6; }
        .status.success { border-left-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .status.warning { border-left-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .status.error { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        
        .video-container { position: relative; background: #000; border-radius: 15px; overflow: hidden; cursor: crosshair; min-height: 300px; border: 2px solid #475569; }
        .video-container.active { border-color: #8b5cf6; box-shadow: 0 0 30px rgba(139, 92, 246, 0.3); }
        .remote-screen { width: 100%; height: auto; display: block; }
        .control-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; }
        .video-placeholder { display: flex; align-items: center; justify-content: center; height: 300px; color: #64748b; font-size: 1.2rem; }
        
        /* Live Controls Styles */
        .live-controls { position: absolute; top: 10px; right: 10px; z-index: 20; }
        .control-btn { background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .controls-menu { position: absolute; top: 45px; right: 0; background: rgba(0, 0, 0, 0.9); border-radius: 8px; padding: 8px; min-width: 150px; }
        .controls-menu button { display: flex; align-items: center; gap: 8px; width: 100%; padding: 8px 12px; background: none; border: none; color: white; cursor: pointer; border-radius: 4px; margin-bottom: 4px; }
        .controls-menu button:hover { background: rgba(255, 255, 255, 0.1); }
        .recording { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Inline Style Fixes */
        .header-flex { display: flex; gap: 1rem; align-items: center; }
        .user-email { color: #cbd5e1; font-size: 0.9rem; }
        .logout-btn { padding: 8px 16px; font-size: 0.9rem; }
        .back-btn { padding: 8px 16px; font-size: 0.9rem; }
        .demo-btn { width: 100%; margin-bottom: 1rem; }
        .center-text { text-align: center; margin-top: 1.5rem; }
        .support-btn { margin-bottom: 0.5rem; }
        .privacy-container { max-width: 800px; }
        .terms-container { max-width: 800px; }
        .contact-container { max-width: 600px; text-align: center; }
        .contact-item { margin: 1.5rem 0; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 10px; }
        .contact-icon { font-size: 2rem; color: #3b82f6; margin-bottom: 0.5rem; }
        .page-title { color: #3b82f6; margin-bottom: 2rem; }
        .page-subtitle { margin-bottom: 1rem; }
        .section-spacing { margin: 2rem 0 1rem; }
        .content-spacing { line-height: 1.6; margin-bottom: 1rem; }
        .contact-spacing { margin-bottom: 2rem; }
        .contact-info { margin: 2rem 0; }
        
        @media (max-width: 1024px) {
            .main-content { grid-template-columns: 1fr; gap: 1.5rem; }
            .app-header-content { flex-direction: column; gap: 1rem; text-align: center; }
        }
        
        /* Mobile-optimized display with toggled toolbar */
        @media (max-width: 768px) {
            .app-header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                transition: top 0.3s ease;
                z-index: 1000;
                background: rgba(15, 23, 42, 0.95);
                backdrop-filter: blur(10px);
            }
            
            .app-header.visible {
                top: 0;
            }
            
            .main-content {
                padding-top: 0;
                height: 100vh;
                overflow: hidden;
            }
            
            .host-section, .client-section {
                height: calc(100vh - 20px);
                margin: 10px;
                overflow-y: auto;
            }
            
            .video-container {
                height: calc(100vh - 200px);
                width: 100%;
            }
            
            /* Mobile toolbar toggle button */
            .mobile-toggle {
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 1001;
                background: rgba(59, 130, 246, 0.9);
                color: white;
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            
            /* Full screen video on mobile */
            .video-container.fullscreen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 999;
                border-radius: 0;
            }
        }
        
        @media (max-width: 480px) {
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; padding: 0 1rem; }
            .cta-btn { padding: 1rem 2rem; font-size: 1rem; }
            .logo-text { font-size: 1rem; }
            .section-title { font-size: 1.8rem; }
            .feature-card { padding: 1.5rem; }
            .feature-icon { font-size: 2.5rem; }
            .feature-card h3 { font-size: 1.2rem; }
            .stat-number { font-size: 2.5rem; }
            .stat-label { font-size: 1rem; }
            .main-content { padding: 0.5rem; }
            .host-section, .client-section { padding: 1rem; }
            .app-title { font-size: 1.1rem; }
            .section-title { font-size: 1.3rem; }
            .section-subtitle { font-size: 0.85rem; }
            .btn { padding: 10px 15px; font-size: 0.9rem; }
            input { padding: 12px; font-size: 1rem; }
            .id-code { font-size: 1.3rem; letter-spacing: 0.1em; }
            .video-container { min-height: 200px; }
            .control-label { font-size: 0.9rem; }
            .status { padding: 1rem; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landing" class="page active">
        <div class="animated-bg">
            <canvas id="bgCanvas"></canvas>
            <!-- Gradient orbs -->
            <div class="gradient-orb orb1"></div>
            <div class="gradient-orb orb2"></div>
            <div class="gradient-orb orb3"></div>
            <!-- Floating particles -->
            <div class="particle particle-1"></div>
            <div class="particle particle-2"></div>
            <div class="particle particle-3"></div>
            <div class="particle particle-4"></div>
            <div class="particle particle-5"></div>
            <div class="particle particle-6"></div>
            <!-- Geometric shapes -->
            <div class="geo-shape triangle geo-triangle"></div>
            <div class="geo-shape square geo-square-1"></div>
            <div class="geo-shape circle geo-circle"></div>
            <div class="geo-shape square geo-square-2"></div>
        </div>
        
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo-text">
                    <i class="fas fa-desktop"></i>
                    Remote Desktop Pro
                </div>
                <nav class="nav-links">
                    <a href="#features">Features</a>
                    <a href="#how">How It Works</a>
                    <a href="#about">About</a>
                    <a href="#contact">Contact</a>
                </nav>
            </div>
        </header>
        
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Remote Desktop Made Simple</h1>
                <p>Access any computer from anywhere in the world. Fast, secure, and completely browser-based. No installation required.</p>
                <button class="cta-btn" id="launchBtn">
                    <i class="fas fa-rocket"></i>
                    Launch Remote Desktop
                </button>
            </div>
        </section>
        
        <!-- Features Section -->
        <section id="features" class="features-section">
            <h2 class="section-title">Powerful Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <h3>Bank-Level Security</h3>
                    <p>End-to-end encrypted connections ensure your data remains private and secure at all times.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-bolt"></i></div>
                    <h3>Lightning Fast</h3>
                    <p>WebRTC technology provides real-time, low-latency connections for smooth remote control.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-globe"></i></div>
                    <h3>Cross-Platform</h3>
                    <p>Works on any device with a web browser - Windows, Mac, Linux, iOS, and Android.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-mouse-pointer"></i></div>
                    <h3>Full Remote Control</h3>
                    <p>Complete mouse and keyboard control with touch support for mobile devices.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-video"></i></div>
                    <h3>HD Screen Sharing</h3>
                    <p>Crystal clear screen sharing with adaptive quality based on your connection.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-code"></i></div>
                    <h3>Simple 6-Digit Code</h3>
                    <p>Connect instantly using a simple 6-digit code. No complex setup required.</p>
                </div>
            </div>
        </section>
        
        <!-- Stats Section -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">Serverless</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">0ms</div>
                    <div class="stat-label">Setup Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">∞</div>
                    <div class="stat-label">Connections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">FREE</div>
                    <div class="stat-label">Forever</div>
                </div>
            </div>
        </section>
        
        <!-- How It Works -->
        <section id="how" class="how-section">
            <h2 class="section-title">How It Works</h2>
            <div class="steps-grid">
                <div class="step">
                    <div class="step-number">01</div>
                    <div class="step-content">
                        <h3>Launch Application</h3>
                        <p>Click the "Launch Remote Desktop" button to start. No downloads or installations needed.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">02</div>
                    <div class="step-content">
                        <h3>Share Your Screen</h3>
                        <p>Click "Share My Screen" to generate a unique 6-digit connection code.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">03</div>
                    <div class="step-content">
                        <h3>Connect & Control</h3>
                        <p>Share the code with others. They enter it to connect and control your screen remotely.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer id="about">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-desktop"></i> Remote Desktop Pro</h4>
                    <p>The most advanced browser-based remote desktop solution. Connect anywhere, anytime, from any device.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="#features">Features</a>
                    <a href="#how">How It Works</a>
                    <a href="#">Documentation</a>
                    <a href="#">API</a>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <button class="btn secondary support-btn" id="privacyBtn">Privacy Policy</button>
                    <button class="btn secondary support-btn" id="termsBtn">Terms of Service</button>
                    <button class="btn secondary" id="contactBtn">Contact Us</button>
                </div>
                <div class="footer-section" id="contact">
                    <h4>Contact Us</h4>
                    <p><i class="fas fa-envelope"></i> sufiangsufian15@gmail.com</p>
                    <p><i class="fas fa-phone"></i> +923447814644</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy;2026 Powerd by Teach Sufian X.</p>
            </div>
        </footer>
    </div>

    <!-- Login Page -->
    <div id="login" class="page">
        <div class="animated-bg">
            <canvas id="loginBgCanvas"></canvas>
        </div>
        
        <div class="login-page">
            <div class="login-container">
                <div class="login-header">
                    <div class="login-title">
                        <i class="fas fa-desktop"></i> Remote Desktop Pro
                    </div>
                    <div class="login-subtitle">Sign in to access your remote desktop</div>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="email" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
                    </div>
                    
                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
                
                <div class="divider">
                    <span>OR</span>
                </div>
                
                <button class="google-btn" id="googleSignInBtn">
                    <i class="fab fa-google"></i> Continue with Google
                </button>
                
                <div class="divider">
                    <span>OR TRY DEMO</span>
                </div>
                
                <button class="btn secondary demo-btn" id="demoBtn">
                    <i class="fas fa-user"></i> Try Demo Account
                </button>
                
                <div class="center-text">
                    <button class="btn secondary back-btn" id="backToHomeBtn">
                        <i class="fas fa-arrow-left"></i> Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Remote Desktop App -->
    <div id="app" class="page">
        <div class="app-container">
            <div class="app-bg">
                <canvas id="appBgCanvas"></canvas>
            </div>
            
            <div class="app-header">
                <div class="app-header-content">
                    <div class="app-title">
                        <i class="fas fa-desktop"></i>
                        Remote Desktop Control
                    </div>
                    <div class="header-flex">
                        <span id="userEmail" class="user-email"></span>
                        <button class="btn secondary logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                        <button class="btn secondary" id="homeBtn">
                            <i class="fas fa-home"></i> Back to Home
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <!-- Host Section -->
                <div class="host-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-share-square"></i>
                        </div>
                        <div class="section-title">Share Your Screen</div>
                        <div class="section-subtitle">Allow others to control your computer</div>
                    </div>
                    
                    <div class="status" id="hostStatus">
                        <i class="fas fa-info-circle"></i> Ready to share screen
                    </div>
                    
                    <div class="control-group">
                        <button class="btn success" id="startHostBtn">
                            <i class="fas fa-share-square"></i>
                            Start Screen Sharing
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <button class="btn hidden" id="mobileShareBtn">
                            <i class="fas fa-video"></i>
                            Share Mobile Camera
                        </button>
                    </div>
                    
                    <div class="id-display hidden" id="myId">
                        <div class="id-label">Share this code with the viewer:</div>
                        <div class="id-code" id="idText"></div>
                        <button class="btn" id="copyIdBtn">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                    </div>
                </div>
                
                <!-- Client Section -->
                <div class="client-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="section-title">Connect to Computer</div>
                        <div class="section-subtitle">Control someone else's computer</div>
                    </div>
                    
                    <div class="status" id="clientStatus">
                        <i class="fas fa-info-circle"></i> Ready to connect
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Enter 6-digit connection code:</label>
                        <div class="input-group">
                            <input type="text" id="connectId" placeholder="123456" maxlength="6">
                            <button class="btn purple" id="connectBtn">
                                <i class="fas fa-plug"></i> Connect
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-container" id="videoContainer">
                        <div class="video-placeholder" id="videoPlaceholder">
                            <i class="fas fa-desktop desktop-icon"></i>
                            <div>Remote screen will appear here</div>
                        </div>
                        <video id="remoteVideo" class="remote-screen hidden" autoplay playsinline></video>
                        <div class="control-overlay hidden" id="controlOverlay"></div>
                        
                        <!-- Live Controls Menu -->
                        <div class="live-controls hidden" id="liveControls">
                            <button class="control-btn" id="toggleMenuBtn">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <div class="controls-menu hidden" id="controlsMenu">
                                <button id="micBtn">
                                    <i class="fas fa-microphone-slash"></i> Enable Mic
                                </button>
                                <button id="recordBtn">
                                    <i class="fas fa-record-vinyl"></i> Record
                                </button>
                                <button id="switchCameraBtn" class="hidden">
                                    <i class="fas fa-camera-rotate"></i> Front Camera
                                </button>
                                <button id="stopSharingBtn">
                                    <i class="fas fa-stop"></i> Stop Sharing
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Page -->
    <div id="privacy" class="page">
        <div class="animated-bg">
            <canvas id="privacyBgCanvas"></canvas>
        </div>
        <div class="login-page">
            <div class="login-container privacy-container">
                <button class="btn secondary" id="privacyBackBtn" class="support-btn">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </button>
                <h1 class="page-title">Privacy Policy</h1>
                <p class="page-subtitle"><strong>Last updated:</strong> December 2024</p>
                
                <h2 class="section-spacing">Information We Collect</h2>
                <p class="content-spacing">We collect information you provide directly to us, such as when you create an account, use our services, or contact us for support.</p>
                
                <h2 class="section-spacing">How We Use Your Information</h2>
                <p class="content-spacing">We use the information we collect to provide, maintain, and improve our services, process transactions, and communicate with you.</p>
                
                <h2 class="section-spacing">Information Sharing</h2>
                <p class="content-spacing">We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy.</p>
                
                <h2 class="section-spacing">Data Security</h2>
                <p class="content-spacing">We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.</p>
                
                <h2 class="section-spacing">Contact Us</h2>
                <p class="content-spacing">If you have any questions about this Privacy Policy, please contact us at sufiangsufian15@gmail.com</p>
            </div>
        </div>
    </div>

    <!-- Terms of Service Page -->
    <div id="terms" class="page">
        <div class="animated-bg">
            <canvas id="termsBgCanvas"></canvas>
        </div>
        <div class="login-page">
            <div class="login-container page-container">
                <button class="btn secondary back-button" id="termsBackBtn">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </button>
                <h1 class="page-header">Terms of Service</h1>
                <p class="page-subtitle"><strong>Last updated:</strong> December 2024</p>
                
                <h2 class="section-spacing">Acceptance of Terms</h2>
                <p class="content-spacing">By accessing and using Remote Desktop Pro, you accept and agree to be bound by the terms and provision of this agreement.</p>
                
                <h2 class="section-spacing">Use License</h2>
                <p class="content-spacing">Permission is granted to temporarily use Remote Desktop Pro for personal, non-commercial transitory viewing only.</p>
                
                <h2 class="section-spacing">Disclaimer</h2>
                <p class="content-spacing">The materials on Remote Desktop Pro are provided on an 'as is' basis. We make no warranties, expressed or implied.</p>
                
                <h2 class="section-spacing">Limitations</h2>
                <p class="content-spacing">In no event shall Remote Desktop Pro or its suppliers be liable for any damages arising out of the use or inability to use the materials.</p>
                
                <h2 class="section-spacing">Contact Information</h2>
                <p class="content-spacing">For questions about these Terms of Service, contact us at sufiangsufian15@gmail.com</p>
            </div>
        </div>
    </div>

    <!-- Contact Page -->
    <div id="contactPage" class="page">
        <div class="animated-bg">
            <canvas id="contactBgCanvas"></canvas>
        </div>
        <div class="login-page">
            <div class="login-container contact-container">
                <button class="btn secondary back-button" id="contactBackBtn">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </button>
                <h1 class="page-header">Contact Us</h1>
                <p class="contact-spacing">Get in touch with us for any questions or support</p>
                
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-envelope contact-icon"></i>
                        <h3>Email</h3>
                        <p>sufiangsufian15@gmail.com</p>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-phone contact-icon"></i>
                        <h3>Phone</h3>
                        <p>+923447814644</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script nonce="rdp-nonce-2024">
        // Security Protection System
        (function() {
            'use strict';
            
            // Only enable security in production (not localhost)
            const isLocalhost = window.location.hostname === 'localhost' || 
                               window.location.hostname === '127.0.0.1' || 
                               window.location.hostname === '';
            
            if (!isLocalhost) {
                // Disable right-click context menu
                document.addEventListener('contextmenu', e => e.preventDefault());
                
                // Disable F12, Ctrl+Shift+I, Ctrl+U, Ctrl+S
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'F12' || 
                        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                        (e.ctrlKey && e.key === 'u') ||
                        (e.ctrlKey && e.key === 's') ||
                        (e.ctrlKey && e.shiftKey && e.key === 'C')) {
                        e.preventDefault();
                        return false;
                    }
                });
                
                // Disable text selection
                document.onselectstart = () => false;
                document.ondragstart = () => false;
                
                // Clear console periodically
                setInterval(() => {
                    console.clear();
                    console.log('%cAccess Denied!', 'color: red; font-size: 50px; font-weight: bold;');
                }, 1000);
            }
        })();
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDp1u-Yx5iVuYDlXu1FgbP3B4WlIjWHPRs",
            authDomain: "share-screen-bc115.firebaseapp.com",
            projectId: "share-screen-bc115",
            storageBucket: "share-screen-bc115.firebasestorage.app",
            messagingSenderId: "944459207166",
            appId: "1:944459207166:web:e87f43cb26ea529e1b30af",
            measurementId: "G-R94VVM57ND"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        let currentUser = null;
        
        // Background sharing state management
        let backgroundSharingActive = false;
        let backgroundPeer = null;
        let backgroundStream = null;
        let backgroundConnection = null;
        let micEnabled = false;
        let originalConstraints = null;
        
        // Network reconnection handling
        let reconnectAttempts = 0;
        let maxReconnectAttempts = 10;
        let reconnectInterval = null;
        
        // Monitor network status
        window.addEventListener('online', () => {
            if (backgroundSharingActive && !backgroundConnection?.open) {
                attemptReconnection();
            }
        });
        
        window.addEventListener('offline', () => {
            console.log('Network offline - will reconnect when back online');
        });
        
        function attemptReconnection() {
            if (reconnectAttempts >= maxReconnectAttempts) return;
            
            reconnectAttempts++;
            console.log(`Reconnection attempt ${reconnectAttempts}`);
            
            setTimeout(() => {
                if (backgroundSharingActive && originalConstraints) {
                    restartSharingSession();
                }
            }, 2000 * reconnectAttempts);
        }
        
        async function restartSharingSession() {
            try {
                if (backgroundPeer) {
                    backgroundPeer.destroy();
                }
                
                const id = document.getElementById('idText').textContent;
                if (id) {
                    // Recreate peer with same ID
                    backgroundPeer = new Peer(id, {
                        config: {
                            iceServers: [
                                { urls: 'stun:stun.l.google.com:19302' },
                                { urls: 'stun:stun1.l.google.com:19302' },
                                { urls: 'stun:stun2.l.google.com:19302' },
                                { urls: 'stun:stun.relay.metered.ca:80' },
                                {
                                    urls: 'turn:openrelay.metered.ca:80',
                                    username: 'openrelayproject',
                                    credential: 'openrelayproject'
                                }
                            ]
                        }
                    });
                    
                    peer = backgroundPeer;
                    
                    peer.on('connection', (connection) => {
                        backgroundConnection = connection;
                        conn = connection;
                        
                        setTimeout(() => {
                            if (originalConstraints) {
                                restartStream();
                            }
                        }, 1000);
                        
                        connection.on('close', () => {
                            if (backgroundSharingActive) {
                                attemptReconnection();
                            }
                        });
                    });
                    
                    reconnectAttempts = 0;
                }
            } catch (error) {
                console.log('Reconnection failed:', error);
                attemptReconnection();
            }
        }
        
        async function restartStream() {
            try {
                if (backgroundStream) {
                    backgroundStream.getTracks().forEach(track => track.stop());
                }
                
                let stream;
                if (originalConstraints.video && originalConstraints.video.facingMode) {
                    // Mobile camera
                    stream = await navigator.mediaDevices.getUserMedia(originalConstraints);
                } else {
                    // Screen share
                    stream = await navigator.mediaDevices.getDisplayMedia(originalConstraints);
                }
                
                backgroundStream = stream;
                localStream = stream;
                
                if (backgroundConnection && backgroundConnection.open) {
                    const call = peer.call(backgroundConnection.peer, stream);
                }
                
            } catch (error) {
                console.log('Stream restart failed:', error);
            }
        }
        
        // Prevent tab close/navigation when sharing (without beforeunload)
        let preventNavigation = false;
        
        // Remove all unload event handling to fix permissions policy
        // Use only pagehide for background sharing
        window.addEventListener('pagehide', (e) => {
            if (backgroundSharingActive) {
                console.log('Page hidden but sharing continues');
            }
        });
        
        // Keep sharing alive in background
        function keepSharingAlive() {
            if (backgroundSharingActive && backgroundPeer && backgroundConnection) {
                // Send heartbeat to maintain connection
                try {
                    if (backgroundConnection.open) {
                        backgroundConnection.send({ type: 'heartbeat', timestamp: Date.now() });
                    }
                } catch (error) {
                    console.log('Heartbeat failed:', error);
                }
            }
        }
        
        // Start heartbeat interval
        setInterval(keepSharingAlive, 5000);
        
        // Override page visibility to keep sharing active
        Object.defineProperty(document, 'hidden', {
            get: () => false,
            configurable: true
        });
        
        Object.defineProperty(document, 'visibilityState', {
            get: () => 'visible',
            configurable: true
        });
        
        // Disable page freeze when backgrounded
        document.addEventListener('visibilitychange', (e) => {
            if (backgroundSharingActive) {
                e.stopImmediatePropagation();
            }
        }, true);
        
        // Disable all Chrome notifications and prompts (without beforeunload)
        // Override notification permissions
        if ('Notification' in window) {
            Object.defineProperty(Notification, 'permission', {
                get: () => 'denied'
            });
        }
        
        // Disable console warnings and errors for permissions policy
        const originalConsole = {
            warn: console.warn,
            error: console.error
        };
        
        console.warn = function(...args) {
            const message = args.join(' ');
            if (!message.includes('Permissions policy') && !message.includes('unload')) {
                originalConsole.warn.apply(console, args);
            }
        };
        
        console.error = function(...args) {
            const message = args.join(' ');
            if (!message.includes('Permissions policy') && !message.includes('unload')) {
                originalConsole.error.apply(console, args);
            }
        };

        
        // Start enhanced background animation immediately
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                console.log('Enhanced background animation started');
            }, 100);
        });
        
        // Animated Background for Login
        function createLoginBackground() {
            const loginCanvas = document.getElementById('loginBgCanvas');
            if (!loginCanvas) return;
            
            const loginCtx = loginCanvas.getContext('2d');
            
            function resizeLoginCanvas() {
                loginCanvas.width = window.innerWidth;
                loginCanvas.height = window.innerHeight;
            }
            
            resizeLoginCanvas();
            
            const loginParticles = [];
            for (let i = 0; i < 30; i++) {
                loginParticles.push({
                    x: Math.random() * loginCanvas.width,
                    y: Math.random() * loginCanvas.height,
                    vx: (Math.random() - 0.5) * 0.2,
                    vy: (Math.random() - 0.5) * 0.2,
                    radius: Math.random() * 2
                });
            }
            
            function animateLoginBackground() {
                loginCtx.clearRect(0, 0, loginCanvas.width, loginCanvas.height);
                loginCtx.fillStyle = 'rgba(59, 130, 246, 0.4)';
                loginCtx.strokeStyle = 'rgba(59, 130, 246, 0.2)';
                
                loginParticles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if (p.x < 0 || p.x > loginCanvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > loginCanvas.height) p.vy *= -1;
                    
                    loginCtx.beginPath();
                    loginCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    loginCtx.fill();
                    
                    loginParticles.forEach((p2, j) => {
                        if (i !== j) {
                            const dx = p.x - p2.x;
                            const dy = p.y - p2.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < 120) {
                                loginCtx.beginPath();
                                loginCtx.moveTo(p.x, p.y);
                                loginCtx.lineTo(p2.x, p2.y);
                                loginCtx.stroke();
                            }
                        }
                    });
                });
                
                requestAnimationFrame(animateLoginBackground);
            }
            
            window.addEventListener('resize', () => {
                resizeLoginCanvas();
                loginParticles.forEach(p => {
                    if (p.x > loginCanvas.width) p.x = loginCanvas.width;
                    if (p.y > loginCanvas.height) p.y = loginCanvas.height;
                });
            });
            
            animateLoginBackground();
        }
        
        // Firebase Authentication Functions - Fixed for localhost
        async function signInWithGoogle() {
            try {
                // Use redirect instead of popup for localhost
                await auth.signInWithRedirect(googleProvider);
                // Redirect callback handled in getRedirectResult below
            } catch (error) {
                console.log('Google sign-in error:', error.message);
                // Fallback to demo account
                signInDemo();
            }
        }
        
        // Handle redirect result - Fixed callback
        auth.getRedirectResult().then((result) => {
            if (result.user) {
                currentUser = result.user;
                console.log('Google sign-in successful:', currentUser);
                saveUserData(currentUser);
                showApp();
            }
        }).catch((error) => {
            console.log('Redirect result error:', error.message);
        });
        
        async function signInDemo() {
            const demoEmail = 'demo@remotedesktop.com';
            const demoPassword = 'demo123456';
            
            try {
                await signInWithEmail(demoEmail, demoPassword);
            } catch (error) {
                console.log('Demo account error:', error);
            }
        }
        
        async function signInWithEmail(email, password) {
            try {
                // First try to sign in
                const result = await auth.signInWithEmailAndPassword(email, password);
                currentUser = result.user;
                console.log('Email sign-in successful:', currentUser);
                await saveUserData(currentUser);
                showApp();
            } catch (error) {
                // If user doesn't exist or wrong password, try creating new account
                if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-login-credentials' || error.code === 'auth/wrong-password') {
                    try {
                        const newResult = await auth.createUserWithEmailAndPassword(email, password);
                        currentUser = newResult.user;
                        console.log('New account created:', currentUser);
                        await saveUserData(currentUser);
                        alert('New account created successfully! Welcome!');
                        showApp();
                    } catch (createError) {
                        if (createError.code === 'auth/email-already-in-use') {
                            alert('Email already exists but password is incorrect. Please check your password.');
                        } else {
                            alert('Authentication failed: ' + createError.message);
                        }
                    }
                } else {
                    alert('Sign-in failed: ' + error.message);
                }
            }
        }
        
        // Save user data to Firestore
        async function saveUserData(user) {
            try {
                await db.collection('users').doc(user.uid).set({
                    email: user.email,
                    displayName: user.displayName || user.email,
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }
        
        // Save screen share session data
        async function saveSessionData(sessionId, sessionType) {
            if (!currentUser) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('sessions').add({
                    sessionId: sessionId,
                    sessionType: sessionType, // 'host' or 'viewer'
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active'
                });
            } catch (error) {
                console.error('Error saving session data:', error);
            }
        }
        
        // Load user's previous sessions
        async function loadUserSessions() {
            if (!currentUser) return;
            
            try {
                const sessions = await db.collection('users').doc(currentUser.uid).collection('sessions')
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                    
                console.log('User sessions:', sessions.docs.map(doc => doc.data()));
            } catch (error) {
                console.error('Error loading sessions:', error);
            }
        }
        
        // Login form handler
        document.addEventListener('DOMContentLoaded', () => {
            // Event listeners for all buttons
            const launchBtn = document.getElementById('launchBtn');
            if (launchBtn) launchBtn.addEventListener('click', checkAuthAndLaunch);
            
            const privacyBtn = document.getElementById('privacyBtn');
            if (privacyBtn) privacyBtn.addEventListener('click', showPrivacy);
            
            const termsBtn = document.getElementById('termsBtn');
            if (termsBtn) termsBtn.addEventListener('click', showTerms);
            
            const contactBtn = document.getElementById('contactBtn');
            if (contactBtn) contactBtn.addEventListener('click', showContact);
            
            const googleSignInBtn = document.getElementById('googleSignInBtn');
            if (googleSignInBtn) googleSignInBtn.addEventListener('click', signInWithGoogle);
            
            const demoBtn = document.getElementById('demoBtn');
            if (demoBtn) demoBtn.addEventListener('click', signInDemo);
            
            const backToHomeBtn = document.getElementById('backToHomeBtn');
            if (backToHomeBtn) backToHomeBtn.addEventListener('click', showLanding);
            
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) logoutBtn.addEventListener('click', logout);
            
            const homeBtn = document.getElementById('homeBtn');
            if (homeBtn) homeBtn.addEventListener('click', showLanding);
            
            const startHostBtn = document.getElementById('startHostBtn');
            if (startHostBtn) startHostBtn.addEventListener('click', startHost);
            
            const mobileShareBtn = document.getElementById('mobileShareBtn');
            if (mobileShareBtn) mobileShareBtn.addEventListener('click', startMobileShare);
            
            const copyIdBtn = document.getElementById('copyIdBtn');
            if (copyIdBtn) copyIdBtn.addEventListener('click', copyId);
            
            const connectBtn = document.getElementById('connectBtn');
            if (connectBtn) connectBtn.addEventListener('click', connectToHost);
            
            const toggleMenuBtn = document.getElementById('toggleMenuBtn');
            if (toggleMenuBtn) toggleMenuBtn.addEventListener('click', toggleControlsMenu);
            
            const micBtn = document.getElementById('micBtn');
            if (micBtn) micBtn.addEventListener('click', toggleMicrophone);
            
            const recordBtn = document.getElementById('recordBtn');
            if (recordBtn) recordBtn.addEventListener('click', startRecording);
            
            const switchCameraBtn = document.getElementById('switchCameraBtn');
            if (switchCameraBtn) switchCameraBtn.addEventListener('click', switchCamera);
            
            const stopSharingBtn = document.getElementById('stopSharingBtn');
            if (stopSharingBtn) stopSharingBtn.addEventListener('click', requestStopSharing);
            
            const privacyBackBtn = document.getElementById('privacyBackBtn');
            if (privacyBackBtn) privacyBackBtn.addEventListener('click', showLanding);
            
            const termsBackBtn = document.getElementById('termsBackBtn');
            if (termsBackBtn) termsBackBtn.addEventListener('click', showLanding);
            
            const contactBackBtn = document.getElementById('contactBackBtn');
            if (contactBackBtn) contactBackBtn.addEventListener('click', showLanding);
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    
                    // Basic validation
                    if (!email || !password) {
                        alert('Please enter both email and password');
                        return;
                    }
                    
                    if (password.length < 6) {
                        alert('Password must be at least 6 characters long');
                        return;
                    }
                    
                    // Disable button during login
                    const loginBtn = document.querySelector('.login-btn');
                    const originalText = loginBtn.innerHTML;
                    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
                    loginBtn.disabled = true;
                    
                    try {
                        await signInWithEmail(email, password);
                    } finally {
                        loginBtn.innerHTML = originalText;
                        loginBtn.disabled = false;
                    }
                });
            }
        });
        
        // Animated Background for App
        function createAppBackground() {
            const appCanvas = document.getElementById('appBgCanvas');
            if (!appCanvas) return;
            
            const appCtx = appCanvas.getContext('2d');
            
            function resizeAppCanvas() {
                appCanvas.width = window.innerWidth;
                appCanvas.height = window.innerHeight;
            }
            
            resizeAppCanvas();
            
            const appParticles = [];
            for (let i = 0; i < 50; i++) {
                appParticles.push({
                    x: Math.random() * appCanvas.width,
                    y: Math.random() * appCanvas.height,
                    vx: (Math.random() - 0.5) * 0.3,
                    vy: (Math.random() - 0.5) * 0.3,
                    radius: Math.random() * 1.5
                });
            }
            
            function animateAppBackground() {
                appCtx.clearRect(0, 0, appCanvas.width, appCanvas.height);
                appCtx.fillStyle = 'rgba(139, 92, 246, 0.3)';
                appCtx.strokeStyle = 'rgba(139, 92, 246, 0.1)';
                
                appParticles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if (p.x < 0 || p.x > appCanvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > appCanvas.height) p.vy *= -1;
                    
                    appCtx.beginPath();
                    appCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    appCtx.fill();
                    
                    appParticles.forEach((p2, j) => {
                        if (i !== j) {
                            const dx = p.x - p2.x;
                            const dy = p.y - p2.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < 80) {
                                appCtx.beginPath();
                                appCtx.moveTo(p.x, p.y);
                                appCtx.lineTo(p2.x, p2.y);
                                appCtx.stroke();
                            }
                        }
                    });
                });
                
                requestAnimationFrame(animateAppBackground);
            }
            
            window.addEventListener('resize', () => {
                resizeAppCanvas();
                appParticles.forEach(p => {
                    if (p.x > appCanvas.width) p.x = appCanvas.width;
                    if (p.y > appCanvas.height) p.y = appCanvas.height;
                });
            });
            
            animateAppBackground();
        }
        
        // Remote Desktop Logic
        let peer, conn, localStream, isHost = false, isViewer = false;
        
        // Check if device supports mobile screen sharing
        function checkMobileSupport() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const mobileBtn = document.getElementById('mobileShareBtn');
            
            if (isMobile) {
                mobileBtn.style.display = 'flex';
            }
        }
        
        function showApp() {
            document.getElementById('landing').classList.remove('active');
            document.getElementById('login').classList.remove('active');
            document.getElementById('app').classList.add('active');
            
            // Display user email
            if (currentUser) {
                document.getElementById('userEmail').textContent = currentUser.email;
            }
            
            // Add mobile toolbar toggle
            addMobileToggle();
            
            setTimeout(() => {
                createAppBackground();
                checkMobileSupport();
                loadUserSessions();
            }, 100);
        }
        
        // Mobile toolbar toggle functionality
        function addMobileToggle() {
            if (window.innerWidth <= 768) {
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'mobile-toggle';
                toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                toggleBtn.onclick = toggleToolbar;
                document.body.appendChild(toggleBtn);
                
                // Hide toolbar initially on mobile
                const header = document.querySelector('.app-header');
                if (header) {
                    header.classList.remove('visible');
                }
            }
        }
        
        function toggleToolbar() {
            const header = document.querySelector('.app-header');
            const toggleBtn = document.querySelector('.mobile-toggle');
            
            if (header.classList.contains('visible')) {
                header.classList.remove('visible');
                toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                header.classList.add('visible');
                toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    header.classList.remove('visible');
                    toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
                }, 3000);
            }
        }
        
        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                cleanup();
                showLanding();
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }
        
        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                if (document.getElementById('login').classList.contains('active')) {
                    showApp();
                }
            } else {
                currentUser = null;
                if (!document.getElementById('landing').classList.contains('active')) {
                    showLogin();
                }
            }
        });
        
        function checkAuthAndLaunch() {
            if (currentUser) {
                showApp();
            } else {
                showLogin();
            }
        }
        
        function showLogin() {
            document.getElementById('landing').classList.remove('active');
            document.getElementById('login').classList.add('active');
            setTimeout(createLoginBackground, 100);
        }
        
        function showLanding() {
            document.getElementById('app').classList.remove('active');
            document.getElementById('login').classList.remove('active');
            document.getElementById('privacy').classList.remove('active');
            document.getElementById('terms').classList.remove('active');
            document.getElementById('contactPage').classList.remove('active');
            document.getElementById('landing').classList.add('active');
            window.scrollTo(0, 0);
            cleanup();
        }
        
        function updateStatus(message, type = 'info') {
            const hostStatus = document.getElementById('hostStatus');
            const clientStatus = document.getElementById('clientStatus');
            
            if (isHost && hostStatus) {
                hostStatus.innerHTML = '<i class="fas fa-info-circle"></i> ' + message;
                hostStatus.className = 'status ' + type;
            } else if (isViewer && clientStatus) {
                clientStatus.innerHTML = '<i class="fas fa-info-circle"></i> ' + message;
                clientStatus.className = 'status ' + type;
            } else {
                if (hostStatus) hostStatus.innerHTML = '<i class="fas fa-info-circle"></i> Ready to share screen';
                if (clientStatus) clientStatus.innerHTML = '<i class="fas fa-info-circle"></i> Ready to connect';
            }
        }
        

        
        async function startHost() {
            try {
                const id = generateId();
                updateStatus('Connecting to signaling server...', 'warning');
                
                // Try WebSocket signaling first, fallback to PeerJS
                try {
                    const connection = new WebRTCConnection(true);
                    await connection.connect(id);
                    
                    // WebSocket signaling successful
                    document.getElementById('myId').style.display = 'block';
                    document.getElementById('idText').textContent = id;
                    updateStatus('Waiting for connection... Share this ID with the viewer.', 'warning');
                    saveSessionData(id, 'host');
                    
                    connection.onStream = (stream) => {
                        updateStatus('Viewer connected! Starting screen share...', 'success');
                        setTimeout(() => shareScreen(), 1000);
                    };
                    
                } catch (wsError) {
                    console.log('WebSocket failed, using PeerJS fallback');
                    
                    // Fallback to PeerJS
                    peer = await connectWithFallback(id, true);
                    backgroundPeer = peer;
                    isHost = true;
                    
                    document.getElementById('myId').style.display = 'block';
                    document.getElementById('idText').textContent = id;
                    updateStatus('Waiting for connection... Share this ID with the viewer.', 'warning');
                    saveSessionData(id, 'host');
                    
                    peer.on('connection', (connection) => {
                        conn = connection;
                        backgroundConnection = connection;
                        updateStatus('Viewer connected! Starting screen share...', 'success');
                        
                        setTimeout(() => shareScreen(), 1000);
                        
                        conn.on('data', (data) => {
                            if (data.type === 'mouse') {
                                simulateMouseEvent(data);
                            } else if (data.type === 'keyboard') {
                                simulateKeyboardEvent(data);
                            } else if (data.type === 'stop_sharing') {
                                stopBackgroundSharing();
                            } else if (data.type === 'stop_request') {
                                if (confirm('Viewer requested to stop sharing. Do you want to stop?')) {
                                    stopBackgroundSharing();
                                }
                            }
                        });
                        
                        conn.on('close', () => {
                            updateStatus('Viewer disconnected', 'warning');
                            stopBackgroundSharing();
                        });
                    });
                    
                    peer.on('call', (call) => {
                        console.log('Unexpected call received by host');
                    });
                    
                    peer.on('error', (err) => {
                        console.error('Peer error:', err);
                        updateStatus('Connection error: ' + err.message, 'error');
                    });
                }
                
            } catch (error) {
                updateStatus('Error starting host: ' + error.message, 'error');
            }
        }
        
        async function startMobileShare() {
            try {
                const id = generateId();
                
                // Use enhanced ICE servers for mobile
                peer = new Peer(id, {
                    config: {
                        iceServers: enhancedIceServers
                    },
                    debug: 0
                });
                
                backgroundPeer = peer;
                isHost = true;
                
                peer.on('open', () => {
                    document.getElementById('myId').style.display = 'block';
                    document.getElementById('idText').textContent = id;
                    updateStatus('Waiting for connection... Share this ID with the viewer.', 'warning');
                    saveSessionData(id, 'host');
                });
                
                peer.on('connection', (connection) => {
                    conn = connection;
                    backgroundConnection = connection;
                    updateStatus('Viewer connected! Starting mobile screen share...', 'success');
                    startAdaptiveMobileShare();
                    
                    conn.on('data', (data) => {
                        if (data.type === 'mouse') {
                            simulateMouseEvent(data);
                        } else if (data.type === 'keyboard') {
                            simulateKeyboardEvent(data);
                        } else if (data.type === 'stop_sharing') {
                            stopBackgroundSharing();
                        } else if (data.type === 'stop_request') {
                            if (confirm('Viewer requested to stop sharing. Do you want to stop?')) {
                                stopBackgroundSharing();
                            }
                        }
                    });
                    
                    conn.on('close', () => {
                        updateStatus('Viewer disconnected', 'warning');
                        stopBackgroundSharing();
                    });
                });
                
                peer.on('error', (err) => {
                    updateStatus('Error: ' + err.message, 'error');
                });
                
            } catch (error) {
                updateStatus('Error starting mobile share: ' + error.message, 'error');
            }
        }
        
        async function startAdaptiveMobileShare() {
            try {
                // Adaptive mobile camera quality
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                let videoConstraints = {
                    video: {
                        facingMode: currentCamera,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: micEnabled
                };
                
                if (connection) {
                    const effectiveType = connection.effectiveType;
                    const downlink = connection.downlink || 1;
                    
                    // Adjust mobile camera quality
                    if (effectiveType === 'slow-2g' || downlink < 0.5) {
                        videoConstraints.video = {
                            facingMode: currentCamera,
                            width: { ideal: 480 },
                            height: { ideal: 320 }
                        };
                    } else if (effectiveType === '2g' || downlink < 1) {
                        videoConstraints.video = {
                            facingMode: currentCamera,
                            width: { ideal: 640 },
                            height: { ideal: 480 }
                        };
                    } else if (effectiveType === '3g' || downlink < 5) {
                        videoConstraints.video = {
                            facingMode: currentCamera,
                            width: { ideal: 854 },
                            height: { ideal: 480 }
                        };
                    }
                }
                
                originalConstraints = videoConstraints;
                
                // Stop existing stream if any
                if (backgroundStream) {
                    backgroundStream.getTracks().forEach(track => track.stop());
                }
                
                localStream = await navigator.mediaDevices.getUserMedia(videoConstraints);
                backgroundStream = localStream;
                backgroundSharingActive = true;
                
                const call = peer.call(conn.peer, localStream);
                
                // Handle mobile call events
                call.on('stream', (stream) => {
                    console.log('Mobile call stream established');
                });
                
                call.on('error', (err) => {
                    console.error('Mobile call error:', err);
                    updateStatus('Mobile sharing error: ' + err.message, 'error');
                });
                
                updateStatus('Mobile camera sharing active - Viewer can see your camera', 'success');
                
                // Show live controls with camera switch option
                document.getElementById('liveControls').style.display = 'block';
                document.getElementById('switchCameraBtn').style.display = 'block';
                
            } catch (error) {
                updateStatus('Error: Camera access denied or not available', 'error');
            }
        }
        
        async function shareScreen() {
            try {
                // Adaptive quality based on connection
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                let videoConstraints = { video: true, audio: micEnabled };
                
                if (connection) {
                    const effectiveType = connection.effectiveType;
                    const downlink = connection.downlink || 1;
                    
                    // Adjust quality based on network speed
                    if (effectiveType === 'slow-2g' || downlink < 0.5) {
                        videoConstraints.video = {
                            width: { max: 640 },
                            height: { max: 480 },
                            frameRate: { max: 15 }
                        };
                    } else if (effectiveType === '2g' || downlink < 1) {
                        videoConstraints.video = {
                            width: { max: 854 },
                            height: { max: 480 },
                            frameRate: { max: 20 }
                        };
                    } else if (effectiveType === '3g' || downlink < 5) {
                        videoConstraints.video = {
                            width: { max: 1280 },
                            height: { max: 720 },
                            frameRate: { max: 25 }
                        };
                    } else {
                        // 4g or better - full quality
                        videoConstraints.video = {
                            width: { max: 1920 },
                            height: { max: 1080 },
                            frameRate: { max: 30 }
                        };
                    }
                }
                
                originalConstraints = videoConstraints;
                localStream = await navigator.mediaDevices.getDisplayMedia(videoConstraints);
                backgroundStream = localStream;
                backgroundSharingActive = true;
                
                const call = peer.call(conn.peer, localStream);
                
                // Handle call events for better reliability
                call.on('stream', (stream) => {
                    console.log('Call stream established');
                });
                
                call.on('close', () => {
                    console.log('Call closed');
                    updateStatus('Screen sharing ended', 'warning');
                });
                
                call.on('error', (err) => {
                    console.error('Call error:', err);
                    updateStatus('Screen sharing error: ' + err.message, 'error');
                });
                
                updateStatus('Screen sharing active - Viewer can now control your screen', 'success');
                
                // Show live controls
                document.getElementById('liveControls').style.display = 'block';
                
                // Override the default onended behavior
                localStream.getVideoTracks()[0].onended = () => {
                    // Only stop if explicitly stopped by user, not by browser
                    if (!backgroundSharingActive) {
                        updateStatus('Screen sharing stopped', 'warning');
                        cleanup();
                    }
                };
                
            } catch (error) {
                updateStatus('Error sharing screen: ' + error.message, 'error');
            }
        }
        
        function connectToHost() {
            const hostId = document.getElementById('connectId').value.trim();
            if (!hostId || hostId.length !== 6) {
                updateStatus('Please enter a valid 6-digit code', 'error');
                return;
            }
            
            updateStatus('Connecting to signaling server...', 'warning');
            
            // Try WebSocket signaling first, fallback to PeerJS
            const tryWebSocketConnection = async () => {
                try {
                    const connection = new WebRTCConnection(false);
                    await connection.connect(hostId);
                    
                    isViewer = true;
                    updateStatus('Connected to host - Waiting for screen share...', 'success');
                    
                    connection.onStream = (remoteStream) => {
                        console.log('Stream received:', remoteStream);
                        const video = document.getElementById('remoteVideo');
                        const placeholder = document.getElementById('videoPlaceholder');
                        const container = document.getElementById('videoContainer');
                        
                        if (video && remoteStream) {
                            video.srcObject = remoteStream;
                            video.autoplay = true;
                            video.playsInline = true;
                            video.muted = false;
                            video.controls = false;
                            
                            video.play().then(() => {
                                video.style.display = 'block';
                                if (placeholder) placeholder.style.display = 'none';
                                if (container) container.classList.add('active');
                                
                                document.getElementById('liveControls').style.display = 'block';
                                updateStatus('Connected! You can now control the remote screen.', 'success');
                                setupRemoteControl();
                            }).catch(error => {
                                console.error('Video play failed:', error);
                                updateStatus('Video playback failed - Check browser permissions', 'error');
                            });
                        }
                    };
                    
                } catch (wsError) {
                    console.log('WebSocket failed, using PeerJS fallback');
                    throw wsError; // Trigger fallback
                }
            };
            
            // Try WebSocket first, then fallback to PeerJS
            tryWebSocketConnection().catch(() => {
                // PeerJS fallback
                connectWithFallback(null, false).then(peerInstance => {
                    peer = peerInstance;
                    isViewer = true;
                    
                    updateStatus('Connecting to host...', 'warning');
                    conn = peer.connect(hostId);
                    saveSessionData(hostId, 'viewer');
                    
                    conn.on('open', () => {
                        updateStatus('Connected to host - Waiting for screen share...', 'success');
                    });
                    
                    conn.on('error', (err) => {
                        console.error('Connection error:', err);
                        updateStatus('Connection failed: ' + err.message, 'error');
                    });
                    
                    conn.on('close', () => {
                        updateStatus('Connection closed by host', 'warning');
                        cleanup();
                    });
                    
                    peer.on('call', (call) => {
                        updateStatus('Receiving video stream...', 'warning');
                        call.answer();
                        
                        const streamTimeout = setTimeout(() => {
                            updateStatus('Stream timeout - Retrying connection...', 'warning');
                            call.close();
                            setTimeout(() => connectToHost(), 2000);
                        }, 15000);
                        
                        call.on('stream', (remoteStream) => {
                            clearTimeout(streamTimeout);
                            
                            const video = document.getElementById('remoteVideo');
                            const placeholder = document.getElementById('videoPlaceholder');
                            const container = document.getElementById('videoContainer');
                            
                            if (video && remoteStream) {
                                video.srcObject = remoteStream;
                                video.autoplay = true;
                                video.playsInline = true;
                                video.muted = false;
                                video.controls = false;
                                
                                video.play().then(() => {
                                    video.style.display = 'block';
                                    if (placeholder) placeholder.style.display = 'none';
                                    if (container) container.classList.add('active');
                                    
                                    document.getElementById('liveControls').style.display = 'block';
                                    updateStatus('Connected! You can now control the remote screen.', 'success');
                                    setupRemoteControl();
                                }).catch(error => {
                                    updateStatus('Video playback failed - Check browser permissions', 'error');
                                });
                            }
                        });
                        
                        call.on('error', (err) => {
                            updateStatus('Video stream error: ' + err.message, 'error');
                        });
                        
                        call.on('close', () => {
                            updateStatus('Video stream ended', 'warning');
                            cleanup();
                        });
                    });
                    
                    peer.on('error', (err) => {
                        updateStatus('Connection error: ' + err.message, 'error');
                    });
                    
                }).catch(error => {
                    updateStatus('Failed to connect: ' + error.message, 'error');
                });
            });
        }
        
        function setupRemoteControl() {
            const overlay = document.getElementById('controlOverlay');
            const video = document.getElementById('remoteVideo');
            overlay.style.display = 'block';
            
            let isDragging = false;
            let lastTouch = null;
            
            function sendMouseEvent(x, y, type, button = 0) {
                if (conn && conn.open) {
                    const rect = video.getBoundingClientRect();
                    const relativeX = (x - rect.left) / rect.width;
                    const relativeY = (y - rect.top) / rect.height;
                    
                    conn.send({
                        type: 'mouse',
                        x: relativeX,
                        y: relativeY,
                        event: type,
                        button: button
                    });
                }
            }
            
            function sendKeyboardEvent(key, type) {
                if (conn && conn.open) {
                    conn.send({
                        type: 'keyboard',
                        key: key,
                        event: type
                    });
                }
            }
            
            // Enhanced mouse events
            overlay.addEventListener('click', (e) => {
                e.preventDefault();
                sendMouseEvent(e.clientX, e.clientY, 'click', e.button);
            });
            
            overlay.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isDragging = true;
                sendMouseEvent(e.clientX, e.clientY, 'mousedown', e.button);
            });
            
            overlay.addEventListener('mouseup', (e) => {
                e.preventDefault();
                isDragging = false;
                sendMouseEvent(e.clientX, e.clientY, 'mouseup', e.button);
            });
            
            overlay.addEventListener('mousemove', (e) => {
                e.preventDefault();
                if (isDragging) {
                    sendMouseEvent(e.clientX, e.clientY, 'drag');
                } else {
                    sendMouseEvent(e.clientX, e.clientY, 'mousemove');
                }
            });
            
            // Enhanced touch events for mobile control
            overlay.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                lastTouch = { x: touch.clientX, y: touch.clientY, time: Date.now() };
                sendMouseEvent(touch.clientX, touch.clientY, 'mousedown', 0);
            }, { passive: false });
            
            overlay.addEventListener('touchend', (e) => {
                e.preventDefault();
                if (lastTouch) {
                    const touch = e.changedTouches[0];
                    const timeDiff = Date.now() - lastTouch.time;
                    const distance = Math.sqrt(
                        Math.pow(touch.clientX - lastTouch.x, 2) + 
                        Math.pow(touch.clientY - lastTouch.y, 2)
                    );
                    
                    // Detect tap vs drag
                    if (timeDiff < 300 && distance < 10) {
                        sendMouseEvent(touch.clientX, touch.clientY, 'click', 0);
                    }
                    
                    sendMouseEvent(touch.clientX, touch.clientY, 'mouseup', 0);
                    lastTouch = null;
                }
            }, { passive: false });
            
            overlay.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                sendMouseEvent(touch.clientX, touch.clientY, 'drag');
            }, { passive: false });
            
            // Double tap for double click
            let tapCount = 0;
            overlay.addEventListener('touchstart', (e) => {
                tapCount++;
                setTimeout(() => {
                    if (tapCount === 2) {
                        const touch = e.touches[0];
                        sendMouseEvent(touch.clientX, touch.clientY, 'dblclick', 0);
                    }
                    tapCount = 0;
                }, 300);
            });
            
            // Pinch to zoom simulation
            let initialDistance = 0;
            overlay.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    initialDistance = Math.sqrt(
                        Math.pow(touch2.clientX - touch1.clientX, 2) + 
                        Math.pow(touch2.clientY - touch1.clientY, 2)
                    );
                }
            });
            
            overlay.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2) {
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    const currentDistance = Math.sqrt(
                        Math.pow(touch2.clientX - touch1.clientX, 2) + 
                        Math.pow(touch2.clientY - touch1.clientY, 2)
                    );
                    
                    const centerX = (touch1.clientX + touch2.clientX) / 2;
                    const centerY = (touch1.clientY + touch2.clientY) / 2;
                    
                    if (currentDistance > initialDistance + 50) {
                        sendMouseEvent(centerX, centerY, 'scroll', 1); // Zoom in
                    } else if (currentDistance < initialDistance - 50) {
                        sendMouseEvent(centerX, centerY, 'scroll', -1); // Zoom out
                    }
                }
            });
            
            // Virtual keyboard for mobile
            const keyboardBtn = document.createElement('button');
            keyboardBtn.innerHTML = '<i class="fas fa-keyboard"></i>';
            keyboardBtn.className = 'control-btn';
            keyboardBtn.style.position = 'absolute';
            keyboardBtn.style.bottom = '10px';
            keyboardBtn.style.right = '10px';
            keyboardBtn.onclick = showVirtualKeyboard;
            overlay.appendChild(keyboardBtn);
            
            // Right-click simulation (long press)
            let longPressTimer;
            overlay.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    longPressTimer = setTimeout(() => {
                        const touch = e.touches[0];
                        sendMouseEvent(touch.clientX, touch.clientY, 'contextmenu', 2);
                    }, 800);
                }
            });
            
            overlay.addEventListener('touchend', () => {
                clearTimeout(longPressTimer);
            });
            
            overlay.addEventListener('touchmove', () => {
                clearTimeout(longPressTimer);
            });
            
            // Keyboard event listeners for desktop
            document.addEventListener('keydown', (e) => {
                if (isViewer && document.getElementById('videoContainer').classList.contains('active')) {
                    e.preventDefault();
                    sendKeyboardEvent(e.key, 'keydown');
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (isViewer && document.getElementById('videoContainer').classList.contains('active')) {
                    e.preventDefault();
                    sendKeyboardEvent(e.key, 'keyup');
                }
            });
        }
        
        function copyId() {
            const idText = document.getElementById('idText').textContent;
            navigator.clipboard.writeText(idText).then(() => {
                updateStatus('ID copied to clipboard! Share this with the viewer.', 'success');
            });
        }
        
        // Connection stats monitoring
        function updateConnectionStats() {
            // Connection stats update code
        }
        
        // Simulate mouse and keyboard events on host side
        function simulateMouseEvent(data) {
            console.log('Simulating mouse event:', data.event, 'at', data.x, data.y);
            // Note: Actual mouse simulation requires browser extensions or native apps
            // This is a placeholder for the simulation logic
        }
        
        function simulateKeyboardEvent(data) {
            console.log('Simulating keyboard event:', data.event, 'key:', data.key);
            // Note: Actual keyboard simulation requires browser extensions or native apps
            // This is a placeholder for the simulation logic
        }
        
        // Virtual keyboard for mobile devices
        function showVirtualKeyboard() {
            const keyboard = document.createElement('div');
            keyboard.id = 'virtualKeyboard';
            keyboard.style.cssText = `
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.9);
                padding: 10px;
                z-index: 1000;
                display: grid;
                grid-template-columns: repeat(10, 1fr);
                gap: 5px;
                max-height: 40vh;
                overflow-y: auto;
            `;
            
            const keys = [
                '1', '2', '3', '4', '5', '6', '7', '8', '9', '0',
                'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p',
                'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';',
                'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/',
                'Space', 'Enter', 'Backspace', 'Tab', 'Shift', 'Ctrl', 'Alt', 'Esc', 'Delete', 'Close'
            ];
            
            keys.forEach(key => {
                const btn = document.createElement('button');
                btn.textContent = key === 'Space' ? '⎵' : key;
                btn.style.cssText = `
                    padding: 10px;
                    background: #333;
                    color: white;
                    border: 1px solid #555;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                `;
                
                btn.onclick = () => {
                    if (key === 'Close') {
                        document.body.removeChild(keyboard);
                    } else {
                        const keyToSend = key === 'Space' ? ' ' : key;
                        sendKeyboardEvent(keyToSend, 'keydown');
                        setTimeout(() => sendKeyboardEvent(keyToSend, 'keyup'), 50);
                    }
                };
                
                keyboard.appendChild(btn);
            });
            
            document.body.appendChild(keyboard);
        }
        
        function cleanup() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            if (peer) {
                peer.destroy();
                peer = null;
            }
            if (conn) {
                conn.close();
                conn = null;
            }
            
            const video = document.getElementById('remoteVideo');
            const placeholder = document.getElementById('videoPlaceholder');
            const container = document.getElementById('videoContainer');
            const overlay = document.getElementById('controlOverlay');
            
            document.getElementById('myId').style.display = 'none';
            document.getElementById('liveControls').style.display = 'none';
            if (video) {
                video.srcObject = null;
                video.style.display = 'none';
            }
            if (placeholder) placeholder.style.display = 'flex';
            if (container) container.classList.remove('active');
            if (overlay) overlay.style.display = 'none';
            
            isHost = false;
            isViewer = false;
            updateStatus('Ready to connect');
        }
        
        // Live Controls Functions
        function toggleControlsMenu() {
            const menu = document.getElementById('controlsMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }
        
        let isRecording = false;
        let mediaRecorder = null;
        
        function startRecording() {
            if (!backgroundStream) {
                alert('No active screen share to record');
                return;
            }
            
            if (isRecording) {
                stopRecording();
                return;
            }
            
            try {
                mediaRecorder = new MediaRecorder(backgroundStream);
                const chunks = [];
                
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) {
                        chunks.push(e.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `screen-recording-${Date.now()}.webm`;
                    a.click();
                    URL.revokeObjectURL(url);
                };
                
                mediaRecorder.start();
                isRecording = true;
                
                // Update button to show recording state
                const recordBtn = document.querySelector('[onclick="startRecording()"]');
                recordBtn.innerHTML = '<i class="fas fa-stop recording"></i> Stop Recording';
                recordBtn.classList.add('recording');
                
                updateStatus('Recording started - Screen activity is being recorded', 'success');
                
            } catch (error) {
                alert('Recording failed: ' + error.message);
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                const recordBtn = document.querySelector('[onclick="startRecording()"]');
                recordBtn.innerHTML = '<i class="fas fa-record-vinyl"></i> Record';
                recordBtn.classList.remove('recording');
                
                updateStatus('Recording stopped and saved', 'success');
            }
        }
        
        let currentCamera = 'environment';
        
        function switchCamera() {
            if (!backgroundStream) return;
            
            currentCamera = currentCamera === 'environment' ? 'user' : 'environment';
            
            // Update button text
            const switchBtn = document.getElementById('switchCameraBtn');
            switchBtn.innerHTML = currentCamera === 'environment' ? 
                '<i class="fas fa-camera-rotate"></i> Front Camera' : 
                '<i class="fas fa-camera-rotate"></i> Back Camera';
            
            // Restart mobile share with new camera
            if (backgroundStream.getVideoTracks()[0].getSettings().facingMode) {
                startAdaptiveMobileShare();
            }
        }
        
        function stopSharing() {
            if (confirm('Are you sure you want to stop screen sharing?')) {
                stopBackgroundSharing();
            }
        }
        
        function requestStopSharing() {
            if (isViewer) {
                // Viewer requesting host to stop sharing
                if (conn && conn.open) {
                    conn.send({ type: 'stop_request' });
                    updateStatus('Stop request sent to host', 'warning');
                }
            } else {
                // Host stopping their own sharing
                stopSharing();
            }
        }
        
        function stopBackgroundSharing() {
            backgroundSharingActive = false;
            micEnabled = false;
            originalConstraints = null;
            reconnectAttempts = 0;
            
            if (reconnectInterval) {
                clearInterval(reconnectInterval);
                reconnectInterval = null;
            }
            
            if (backgroundStream) {
                backgroundStream.getTracks().forEach(track => track.stop());
                backgroundStream = null;
            }
            
            if (backgroundConnection && backgroundConnection.open) {
                backgroundConnection.send({ type: 'stop_sharing' });
            }
            
            if (backgroundPeer) {
                backgroundPeer.destroy();
                backgroundPeer = null;
            }
            
            backgroundConnection = null;
            
            // Stop recording if active
            if (isRecording) {
                stopRecording();
            }
            
            // Reset mic button
            const micBtn = document.getElementById('micBtn');
            if (micBtn) {
                micBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Enable Mic';
            }
            
            cleanup();
            updateStatus('Screen sharing stopped by user', 'warning');
        }
        
        // Microphone control function
        async function toggleMicrophone() {
            if (!backgroundStream) {
                alert('No active sharing session');
                return;
            }
            
            const micBtn = document.getElementById('micBtn');
            
            try {
                if (micEnabled) {
                    // Disable microphone
                    const audioTracks = backgroundStream.getAudioTracks();
                    audioTracks.forEach(track => {
                        track.stop();
                        backgroundStream.removeTrack(track);
                    });
                    
                    micEnabled = false;
                    micBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Enable Mic';
                    updateStatus('Microphone disabled', 'warning');
                    
                } else {
                    // Enable microphone
                    const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const audioTrack = audioStream.getAudioTracks()[0];
                    
                    backgroundStream.addTrack(audioTrack);
                    
                    // Update the call with new stream
                    if (backgroundConnection && backgroundConnection.open) {
                        const call = peer.call(backgroundConnection.peer, backgroundStream);
                    }
                    
                    micEnabled = true;
                    micBtn.innerHTML = '<i class="fas fa-microphone"></i> Disable Mic';
                    updateStatus('Microphone enabled - Viewer can hear your audio', 'success');
                }
                
                // Update original constraints for reconnection
                if (originalConstraints) {
                    originalConstraints.audio = micEnabled;
                }
                
            } catch (error) {
                alert('Microphone access failed: ' + error.message);
            }
        }
        
        function showPrivacy() {
            document.getElementById('landing').classList.remove('active');
            document.getElementById('login').classList.remove('active');
            document.getElementById('app').classList.remove('active');
            document.getElementById('terms').classList.remove('active');
            document.getElementById('contactPage').classList.remove('active');
            document.getElementById('privacy').classList.add('active');
            setTimeout(createLoginBackground, 100);
        }
        
        function showTerms() {
            document.getElementById('landing').classList.remove('active');
            document.getElementById('login').classList.remove('active');
            document.getElementById('app').classList.remove('active');
            document.getElementById('privacy').classList.remove('active');
            document.getElementById('contactPage').classList.remove('active');
            document.getElementById('terms').classList.add('active');
            setTimeout(createLoginBackground, 100);
        }
        
        function showContact() {
            document.getElementById('landing').classList.remove('active');
            document.getElementById('login').classList.remove('active');
            document.getElementById('app').classList.remove('active');
            document.getElementById('privacy').classList.remove('active');
            document.getElementById('terms').classList.remove('active');
            document.getElementById('contactPage').classList.add('active');
            setTimeout(createLoginBackground, 100);
        }
        
        // Live Background Graphics for all pages
        function initializeLiveBackgrounds() {
            createLiveBackground('bgCanvas');
            createLiveBackground('loginBgCanvas');
            createLiveBackground('appBgCanvas');
            createLiveBackground('privacyBgCanvas');
            createLiveBackground('termsBgCanvas');
            createLiveBackground('contactBgCanvas');
        }
        
        function createLiveBackground(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let particles = [];
            let time = 0;
            
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            function createParticle() {
                return {
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: (Math.random() - 0.5) * 1.5,
                    size: Math.random() * 2 + 1,
                    hue: Math.random() * 60 + 200,
                    life: 1
                };
            }
            
            function animate() {
                ctx.fillStyle = 'rgba(15, 23, 42, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Gradient overlay
                const gradient = ctx.createRadialGradient(
                    canvas.width/2, canvas.height/2, 0,
                    canvas.width/2, canvas.height/2, canvas.width/2
                );
                gradient.addColorStop(0, 'rgba(59, 130, 246, 0.1)');
                gradient.addColorStop(1, 'rgba(139, 92, 246, 0.05)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Manage particles
                if (particles.length < 40) {
                    particles.push(createParticle());
                }
                
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 0.003;
                    
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    
                    ctx.save();
                    ctx.globalAlpha = p.life * 0.8;
                    ctx.fillStyle = `hsl(${p.hue + time * 0.5}, 70%, 60%)`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                    
                    if (p.life <= 0) particles.splice(i, 1);
                });
                
                // Draw connections
                particles.forEach((p1, i) => {
                    particles.slice(i + 1).forEach(p2 => {
                        const dx = p1.x - p2.x;
                        const dy = p1.y - p2.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < 120) {
                            ctx.save();
                            ctx.globalAlpha = (120 - dist) / 120 * 0.3;
                            ctx.strokeStyle = `hsl(${220 + time * 0.3}, 60%, 50%)`;
                            ctx.lineWidth = 1;
                            ctx.beginPath();
                            ctx.moveTo(p1.x, p1.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                            ctx.restore();
                        }
                    });
                });
                
                time += 0.8;
                requestAnimationFrame(animate);
            }
            
            resize();
            animate();
            window.addEventListener('resize', resize);
        }

    </script>
</body>
</html>